# 赵秦 - 人物深度分析计划

> 张成的重要女性角色：初恋姐姐 → 同事 → 女朋友

**创建时间**: 2025-12-10
**最后更新**: 2025-12-11
**分析状态**: 全部完成 (100% 覆盖率)

---

## 1. 人物定位

### 基本信息
- **姓名**: 赵秦
- **性别**: 女
- **与主角关系**: 张成初恋女友的姐姐，后发展为同事、女朋友

### 关系演变轨迹
```
初恋女友的姐姐 → 同事 → 女朋友
     ↓              ↓        ↓
  身份认知      工作交集    感情确立
```

### 分析价值
- 张成重要的感情线人物
- 关系身份多次转变，心理变化丰富
- 从"姐姐"到"恋人"的微妙转变值得深挖

---

## 2. 数据概览

### 出场统计
| 指标 | 数值 |
|------|------|
| 总出现章节 | 1112 章 |
| 首次出场 | 第 169 章 |
| 最后出场 | 第 8098 章 |
| 出场占比 | 13.7% (1112/8098) |

### 当前分析状态
| 阶段 | 章节数 | 覆盖率 | 状态 |
|------|--------|--------|------|
| Phase 1 智能采样 | 30 | 2.7% | ✅ 已完成 |
| Phase 2 增量分析 | 530 | 50.4% | ✅ 已完成 |
| Phase 3 全量分析 | 552 | 100% | ✅ 已完成 (2025-12-11) |

**当前总计**: 1112/1112 章 (100%)

**新增功能** (2025-12-11):
- ✅ 第一人称叙事视角处理
- ✅ 结构化互动记录 (`CharacterInteraction`)
- ✅ 情感状态、关键时刻等增强字段
- ✅ 关联人物发现 (`discovered_characters`)

---

## 3. 分析目标

### 核心问题
1. **初识阶段**: 赵秦第一次出场是什么情境？作为"初恋姐姐"的定位是怎样的？
2. **身份转变**: 从"姐姐"到"同事"是怎么发生的？有什么契机？
3. **感情发展**: 两人感情是如何从同事升温到恋人的？关键节点在哪？
4. **性格特点**: 赵秦的性格、行事风格、价值观是怎样的？
5. **与张成的互动模式**: 两人相处的方式有什么特点？

### 想要的输出
- 完整的人物性格画像
- 关系发展时间线
- 关键事件列表（按重要性排序）
- 代表性对话/场景
- 与其他角色的关系网络

---

## 4. 分析策略

### 阶段划分

#### Phase 1: 全书脉络（已完成）
- **目标**: 建立基础认知，了解大致轨迹
- **方法**: 智能采样 30 章，均匀覆盖全书
- **状态**: ✅ 已完成

#### Phase 2: 初识与关系建立期
- **目标**: 深入了解赵秦初登场、与张成的初期互动
- **章节范围**: 第 169 章 - 第 500 章（预估）
- **重点关注**:
  - 初次见面场景
  - "初恋姐姐"身份的展现
  - 早期互动模式
- **预计章节**: 50-80 章

#### Phase 3: 同事阶段
- **目标**: 分析工作关系中的相处
- **章节范围**: 待确定（需要你提供大概章节）
- **重点关注**:
  - 成为同事的契机
  - 工作中的配合与冲突
  - 感情萌芽的迹象

#### Phase 4: 感情确立期
- **目标**: 深入分析感情升温到确立的过程
- **章节范围**: 待确定
- **重点关注**:
  - 关键告白/确立场景
  - 恋爱后的相处模式
  - 重要的感情事件

#### Phase 5: 持续补充
- **目标**: 查漏补缺，完善细节
- **方法**: 根据前几阶段发现的线索，针对性补充

---

## 5. 执行计划

### 脚本准备
```bash
# Phase 1: 智能采样（已完成）
python scripts/analyze.py 赵秦

# Phase 2: 增量分析（待执行）
python scripts/analyze.py 赵秦 --continue --chapters 100

# 查看分析状态
python scripts/analyze.py 赵秦 --status
```

### 时间安排
| 阶段 | 预计耗时 | 计划执行 |
|------|----------|----------|
| Phase 1 | 5 分钟 | ✅ 2025-12-10 |
| Phase 2 | 15-20 分钟 | 待定 |
| Phase 3 | 15-20 分钟 | 待定 |
| Phase 4 | 15-20 分钟 | 待定 |

---

## 6. 分析进度日志

### 2025-12-11
- [x] 第一人称叙事视角适配
- [x] 数据模型扩展（CharacterInteraction、增强字段）
- [x] 删除旧数据，使用新 prompt 重新分析
- [x] Phase 2 增量分析完成（530 章）
- [x] Phase 3 全量分析完成（552 章），达到 100% 覆盖
- [x] 刷新总结，生成完整分析数据
- [x] 前端适配新数据格式

### 2025-12-10
- [x] 创建分析计划文档
- [x] Phase 1 智能采样完成（30 章，覆盖 169-8097）

---

## 7. 待确认问题

> 请补充以下信息，帮助更精准地分析：

1. **初恋女友是谁？** 她和赵秦在书中还有互动吗？
2. **成为同事大概在第几章？** （大概范围即可）
3. **正式确立关系大概在第几章？**
4. **有没有特别印象深刻的赵秦相关章节？**

---

## 8. 相关文件

### 数据文件
- 人物列表: `data/analysis/a04f9ba66252/characters.json`
- 详细分析: `data/analysis/a04f9ba66252/characters/赵秦/profile.json`

### 分析脚本
- `scripts/analyze.py` - 统一人物分析 CLI（支持智能采样、增量分析、状态查看）

### 前端展示
- URL: `http://localhost:5173/characters/赵秦`

---

## 9. 技术实现细节

### 9.1 数据存储结构

#### 详细分析文件
**路径**: `data/analysis/{book_id}/characters/{人物名}/profile.json`
**示例**: `characters/赵秦/profile.json`

```json
{
  "name": "赵秦",
  "aliases": ["秦姐", "赵总"],           // 别名列表
  "description": "人物简介（100-200字）",
  "role": "supporting",                  // protagonist/antagonist/supporting/minor
  "personality": ["温柔", "干练", "独立"], // 性格特点

  // 深度分析字段
  "summary": "一句话人物定位",
  "growth_arc": "成长轨迹描述",
  "core_traits": [                       // 核心性格特征
    {
      "trait": "独立自主",
      "description": "描述",
      "evidence": "原文证据"
    }
  ],
  "strengths": ["优点1", "优点2"],
  "weaknesses": ["缺点1", "缺点2"],
  "notable_quotes": ["经典台词1", "经典台词2"],

  // 出场信息
  "appearances": [                       // 章节出场详情
    {
      "chapter_index": 168,
      "chapter_title": "第一百六十九章 ...",
      "events": ["本章主要事件"],
      "interactions": ["与其他角色的互动"],
      "quote": "代表性台词"
    }
  ],
  "first_appearance": 168,               // 首次出场章节索引
  "last_appearance": 8097,               // 最后出场章节索引
  "total_chapters": 1112,                // 总出场章节数

  // 人物关系
  "relations": [
    {
      "target_name": "张成",
      "relation_type": "lover",          // friend/enemy/lover/family/mentor/rival
      "description": "从初恋姐姐发展为恋人",
      "evidence_chapters": [168, 500, 1000]
    }
  ],

  // 分析元信息
  "analysis_status": "completed",        // pending/analyzing/completed
  "analyzed_chapters": [168, 288, ...],  // 已分析的章节列表
  "total_analyzed_chapters": 30,
  "error_message": ""
}
```

#### 人物列表文件
**路径**: `data/analysis/{book_id}/characters.json`

```json
[
  {
    "id": "3c755ea96b38",
    "name": "赵秦",
    "aliases": [],
    "description": "简短描述",
    "first_appearance": 168,
    "role": "supporting",
    "attributes": {}
  }
]
```

### 9.2 分析流程

```
┌─────────────────────────────────────────────────────────────┐
│                      分析流程                                │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. 搜索阶段                                                 │
│     └─→ 正则搜索全书，找出所有出现章节                        │
│         └─→ 输出: found_in_chapters = [168, 169, ...]       │
│                                                             │
│  2. 采样阶段                                                 │
│     └─→ 智能采样（均匀分布）或指定章节                        │
│         └─→ 输出: chapters_to_analyze = [168, 288, ...]     │
│                                                             │
│  3. 章节分析阶段（逐章 AI 分析）                              │
│     └─→ 提取: events, interactions, quote                   │
│         └─→ 输出: appearances[] 数组                        │
│                                                             │
│  4. 关系分析阶段                                             │
│     └─→ 基于所有互动记录，分析人物关系                        │
│         └─→ 输出: relations[] 数组                          │
│                                                             │
│  5. 性格分析阶段                                             │
│     └─→ 基于所有表现，总结性格特点                           │
│         └─→ 输出: description, personality, role            │
│                                                             │
│  6. 深度分析阶段（可选）                                      │
│     └─→ 生成总结、成长轨迹、核心特征等                        │
│         └─→ 输出: summary, growth_arc, core_traits, ...     │
│                                                             │
│  7. 保存阶段                                                 │
│     └─→ 写入 JSON 文件                                      │
│         └─→ characters/{人物名}/profile.json                │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 9.3 API 端点

| 端点 | 方法 | 功能 |
|------|------|------|
| `/api/analysis/{book_id}/characters/search` | POST | 搜索人物出现章节 |
| `/api/analysis/{book_id}/characters/stream` | GET | SSE 流式分析（脚本用） |
| `/api/analysis/{book_id}/characters/continue` | GET | 增量分析更多章节 |
| `/api/analysis/{book_id}/characters/detailed/{name}` | GET | 获取详细分析结果 |
| `/api/analysis/{book_id}/characters/detailed` | GET | 获取所有已分析人物 |

### 9.4 前端展示更新

#### 数据获取
```javascript
// apps/web/src/services/api.js
analysisApi.getDetailedCharacter(bookId, '赵秦')
// → GET /api/analysis/{bookId}/characters/detailed/赵秦
// → 返回 JSON 文件内容
```

#### 页面展示
**路由**: `/characters/赵秦`
**组件**: `CharacterDetail.jsx`

**展示区块**:
1. **Header** - 名字、别名、角色类型、出场统计
2. **Summary** - 一句话定位
3. **Growth Arc** - 成长轨迹
4. **Core Traits** - 核心性格（带证据）
5. **Strengths/Weaknesses** - 优缺点
6. **Notable Quotes** - 经典语录
7. **Relations** - 人物关系卡片
8. **Appearances** - 章节出场列表（可展开）

#### 更新机制
```
分析脚本执行 → JSON 文件更新 → 刷新前端页面 → 自动加载最新数据
```

前端通过 `loadCached()` 读取 JSON 文件，无需额外操作。

---

## 10. 增量分析脚本模板

当需要针对特定章节范围分析时，可以创建专用脚本：

```python
#!/usr/bin/env python3
"""赵秦 Phase 2 分析 - 初识与关系建立期"""

import asyncio
import sys
from pathlib import Path

sys.path.insert(0, str(Path(__file__).parent.parent / "apps" / "api"))

from src.core.book import BookManager
from src.ai.tasks.character_analyzer import CharacterOnDemandAnalyzer

BOOK_ID = "a04f9ba66252"
CHARACTER_NAME = "赵秦"
CHAPTER_RANGE = (169, 500)  # 分析第 169-500 章

async def main():
    book = BookManager.get_book(BOOK_ID)
    analyzer = CharacterOnDemandAnalyzer()

    # 搜索出现章节
    search = analyzer.search(book, CHARACTER_NAME)

    # 筛选指定范围
    chapters = [c for c in search.found_in_chapters
                if CHAPTER_RANGE[0] <= c <= CHAPTER_RANGE[1]]

    print(f"范围内章节: {len(chapters)} 章")

    # 逐章分析...
    # （具体实现参考 character_analyzer.py）

if __name__ == "__main__":
    asyncio.run(main())
```

---

## 11. 备注

- 赵秦不在 `characters.json` 人物列表中（人物提取时采样章节未覆盖到）
- 分析完成后需要手动添加到人物列表，或通过脚本自动更新
- 前端 Characters 页面目前只显示 `characters.json` 中的人物
- 但可以通过直接访问 `/characters/赵秦` 查看详细分析结果
