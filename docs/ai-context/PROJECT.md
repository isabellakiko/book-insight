# 项目愿景与设计

> 记录项目的动机、需求和设计理念 - 帮助 AI 理解"为什么这样做"

**创建时间**: 2025-12-09
**最后更新**: 2025-12-10 17:10

---

## 为什么做这个项目

### 阅读长篇小说的痛点

1. **人物记忆困难** - 角色众多，读到后面忘了前面的人物关系
2. **情节回顾困难** - 想找某个情节在哪一章，只能手动翻找
3. **深度理解不足** - 缺乏对人物发展、伏笔、关系变化的系统性分析

### 解决思路

用 AI 增强阅读体验：
- **不是替代阅读**，而是阅读后的辅助工具
- **基于原文**，确保信息有据可查
- **按需分析**，关注什么就分析什么

---

## 核心需求

### 人物分析（核心功能）

**需求场景**：
> "我想了解赵秦这个人物，他出现在哪些章节，每章发生了什么，整体人物发展是怎样的"

**设计要点**：
- 按需分析，而不是一次性提取所有人物
- 用户指定人物名 → 全书搜索 → 逐章分析 → 生成人物档案
- 分析结果存储，前端只展示，不实时调用 AI（省 API 费用）

**分析内容**：
- 出现在哪些章节（精确列表）
- 每章的事件、互动、代表性描述
- 人物关系
- 整体发展脉络

### RAG 问答（已完成）

**需求场景**：
> "这本书里谁和谁是什么关系？某个情节在哪一章？"

**实现方案**：
- ChromaDB 本地向量存储
- LangChain RecursiveCharacterTextSplitter 分块
- 阿里云百炼 text-embedding-v3 向量化
- 支持向量检索 + AI 生成回答

---

## 设计理念

### 1. 脚本分析 + 前端展示（核心架构）

```
┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐
│   脚本分析       │  →   │   JSON 文件     │  →   │   前端展示       │
│ scripts/*.py    │      │ data/analysis/  │      │ 纯可视化        │
└─────────────────┘      └─────────────────┘      └─────────────────┘
     长期积累               持久化存储              只读展示
```

**工作流程**：
1. **后端脚本**：调用 AI 分析，生成结构化数据
2. **JSON 文件**：持久化存储分析结果
3. **前端页面**：读取文件，可视化展示

**核心原则**：
- ❌ 前端不触发实时 AI 分析
- ✅ 前端只展示已有的分析结果
- ✅ 分析通过脚本离线执行，支持增量积累

**好处**：
- 节省 API 费用（按需分析，只分析一次）
- 前端响应快（直接读 JSON，无等待）
- 可以人工审核、修改分析结果
- 支持长期积累，逐步完善人物档案

### 2. 章节独立存储

```
data/books/{book_id}/chapters/
├── 0001.json    # 第1章
├── 0002.json    # 第2章
└── ...
```

**好处**：
- 人物分析时方便引用
- 知道数据来源是哪一章
- 便于后续 RAG 处理

### 3. 人物分层存储

```
data/analysis/{book_id}/characters/{name}/
├── profile.json       # 基础信息（轻量，快速加载）
└── appearances/
    ├── 0001.json      # 第1章出场详情
    └── ...            # 按需加载
```

**好处**：
- 避免单个 JSON 文件过大（主角可能出现上千章）
- 前端首屏快速加载 profile
- 用户点击某章才加载详情

---

## 当前聚焦

### 目标书籍
**《那些热血飞扬的日子》** - 7540 章

### 第一个分析人物
**赵秦** - 作为示例，验证整个分析流程

### 分析脚本

位于 `scripts/` 目录：

| 脚本 | 功能 | 用法 |
|------|------|------|
| `reanalyze_zhaoqin.py` | 智能采样分析（覆盖全书） | `python3 scripts/reanalyze_zhaoqin.py` |
| `continue_zhaoqin_analysis.py` | 增量分析更多章节 | `python3 scripts/continue_zhaoqin_analysis.py` |
| `analyze_zhaoqin_deep.py` | 深度分析（总结、成长） | `python3 scripts/analyze_zhaoqin_deep.py` |
| `analyze_character.py` | 通用人物分析脚本 | 需修改人物名后运行 |

### 分析流程
1. 运行分析脚本（调用后端 API）
2. 脚本生成 JSON 文件到 `data/analysis/`
3. 前端自动展示最新分析结果（刷新页面）

---

## 未来可能

- [ ] 支持更多书籍格式（EPUB、PDF）
- [ ] 人物关系图谱可视化（网络图）
- [ ] 多书籍对比分析
- [ ] RAG 智能问答（代码完成，待测试）
- [x] 情节时间线（已完成）

---

**文档定位**: 理解项目"为什么"，指导设计决策
**更新频率**: 需求或设计理念变化时
